<!--page/wardrobe/index/index.wxml-->
<view class="container">
  <!-- Loading state -->
  <view class="loading-overlay" wx:if="{{isLoading}}">
    <view class="loading-spinner"></view>
    <view class="loading-text">加载中...</view>
  </view>
  
  <!-- Weather widget -->
  <view class="weather-widget" bindtap="viewWeatherDetail">
    <view class="weather-info">
      <view class="weather-location">{{weather.city}}，{{weather.day}}</view>
      <view class="weather-temp">{{weather.temperature}}</view>
      <view class="weather-condition">{{weather.condition}}</view>
    </view>
    <view class="weather-icon">
      <view class="weather-icon-img">
        <image wx:if="{{weather.iconUrl}}" src="{{weather.iconUrl}}" mode="aspectFit" class="weather-icon-image"></image>
        <view class="icon-sun" wx:elif="{{weather.icon == 'sun'}}"></view>
        <view class="icon-cloud" wx:elif="{{weather.icon == 'cloud'}}"></view>
        <view class="icon-rain" wx:elif="{{weather.icon == 'rain'}}"></view>
      </view>
    </view>
  </view>
  
  <!-- OOTD and outfit area -->
  <view class="ootd-container">
    <!-- Model display -->
    <view class="model-section">
      <view class="section-header">
        <view class="section-title">今日造型</view>
      </view>
      
      <view class="model-container" bindtap="uploadPersonalPhoto">
        <image 
          wx:if="{{modelImageUrl}}"
          src="{{modelImageUrl}}"
          mode="aspectFill"
          class="model-image"
        ></image>
        <image 
          wx:else
          src="{{defaultModelUrl || '/image/default-model.png'}}"
          mode="aspectFill"
          class="model-image"
        ></image>
        <view class="model-upload-overlay">
          <view class="model-upload-text">点击上传照片生成AI形象</view>
        </view>
      </view>
    </view>
    
    <!-- Recommended outfits -->
    <view class="outfit-section">
      <view class="section-header">
        <view class="section-title">搭配推荐</view>
        <view class="recommend-button" bindtap="getOutfitRecommendation" wx:if="{{!isGeneratingOutfit && recommendedOutfit.length === 0}}">
          <text class="recommend-button-text">获取推荐</text>
        </view>
      </view>
      
      <view class="outfit-cards">
        <block wx:if="{{recommendedOutfit.length > 0}}">
          <view class="outfit-card" wx:for="{{recommendedOutfit}}" wx:key="_id" bindtap="viewClothesDetail" data-id="{{item._id}}">
            <image 
              wx:if="{{item.tempImageUrl}}"
              src="{{item.tempImageUrl}}"
              mode="aspectFill"
              class="outfit-card-image"
            ></image>
            <view class="outfit-card-icon {{item.category == '上衣' ? 'tops' : (item.category == '裤子' ? 'pants' : (item.category == '外套' ? 'coat' : (item.category == '裙子' ? 'skirt' : 'jacket')))}}" wx:else></view>
            <view class="outfit-card-info">
              <view class="outfit-card-name">{{item.name || item.category}}</view>
              <view class="outfit-card-type">{{item.clothingType || item.category}}</view>
            </view>
          </view>
        </block>
        
        <view class="thinking-container" wx:elif="{{isGeneratingOutfit}}">
          <view class="thinking-animation">
            <view class="thinking-dot"></view>
            <view class="thinking-dot"></view>
            <view class="thinking-dot"></view>
          </view>
          <view class="thinking-text">DeepSeek正在思考适合今天天气的搭配...</view>
        </view>
        
        <view class="empty-outfit" wx:else>
          <view class="empty-outfit-text">点击"获取推荐"按钮，基于天气获取最适合今天的穿搭建议</view>
        </view>
      </view>
    </view>
  </view>
  
  <!-- Generation status indicator -->
  <view class="generating-status" wx:if="{{isGeneratingModel}}">
    <view class="generating-spinner"></view>
    <view class="generating-text">AI造型生成中...</view>
  </view>
</view>
