<view class="container" style="background-color: {{colors.lightTaupe}};">
  <!-- Loading state -->
  <view class="loading-container" wx:if="{{isLoading}}">
    <view class="loading-spinner" style="border-top-color: {{colors.darkOlive}}; border-color: {{colors.lightTaupe}};"></view>
    <view class="loading-text" style="color: {{colors.darkOlive}};">åŠ è½½ä¸­...</view>
  </view>
  
  <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
  <view class="main-content" wx:if="{{!isLoading}}">
    <!-- æ ‡é¢˜ -->
    <view class="wardrobe-title">æˆ‘çš„è¡£æŸœ</view>
    
    <!-- å¡ç‰‡åŒºåŸŸ -->
    <view class="card-container">
      <!-- æ»‘åŠ¨æŒ‰é’® -->
      <view class="nav-button prev" catchtap="slidePrev" style="color: {{colors.darkOlive}};">â—€</view>
      
      <!-- ç±»åˆ«å¡ç‰‡ -->
      <view class="card-wrapper" 
            capture-bind:touchstart="handleTouchStart" 
            capture-bind:touchmove="handleTouchMove" 
            capture-bind:touchend="handleTouchEnd"
            capture-bind:touchcancel="handleTouchEnd">
        <view 
          wx:for="{{categories}}" 
          wx:key="id"
          class="category-card {{currentIndex === index ? 'active' : ''}} {{isSliding || slidingLocked || Date.now() - lastSlideTime < 800 ? 'no-tap' : ''}} {{Date.now() - lastSlideTime < 100 ? 'card-cooling' : ''}}" 
          style="background-color: {{currentIndex === index ? colors.mediumBrown : colors.lightTaupe}}; z-index: {{cards[index].zIndex}}; transform: translateX({{cards[index].translateX}}rpx) scale({{cards[index].scale}}); opacity: {{cards[index].opacity}};"
          catchtap="onCardTap"
          data-index="{{index}}"
          hover-class="{{!isSliding && !slidingLocked && Date.now() - lastSlideTime >= 800 ? 'card-hover' : ''}}"
          hover-stay-time="50"
          hover-start-time="50"
          hidden="{{!cards[index].visible}}"
        >
          <view class="category-icon" style="background-color: {{colors.darkOlive}}; color: {{colors.lightTaupe}};">
            {{item.icon}}
          </view>
          <text class="category-name" style="color: {{colors.darkOlive}};">{{item.name}}</text>
          <text class="category-en-name" style="color: {{colors.darkCoffee}};">{{item.enName}}</text>
          <text class="category-count" style="color: {{colors.darkCoffee}};">{{item.count}} ä»¶</text>
        </view>
      </view>
      
      <!-- æ»‘åŠ¨æŒ‰é’® -->
      <view class="nav-button next" catchtap="slideNext" style="color: {{colors.darkOlive}};">â–¶</view>
    </view>
  </view>
  
  <!-- è¯¦æƒ…å¤§å¡ç‰‡ -->
  <view class="detail-card-container" wx:if="{{selectedCategory}}" bindtap="onDetailBackgroundTap">
    <view 
      class="detail-card" 
      style="background-color: {{colors.mediumBrown}};"
      catchtap="preventBubble"
    >
      <!-- å¡ç‰‡é¡¶éƒ¨ -->
      <view class="detail-header">
        <text class="detail-title" style="color: {{colors.darkOlive}};">{{selectedCategory.name}}</text>
        <view class="close-button" bindtap="closeDetail" style="color: {{colors.darkOlive}};">Ã—</view>
      </view>

      <!-- è¡£ç‰©ç½‘æ ¼ -->
      <scroll-view class="clothes-grid" scroll-y="true" enable-flex="true">
        <view class="grid-container">
          <block wx:for="{{currentPageClothes}}" wx:key="_id">
            <view 
              class="clothes-item" 
              style="background-color: {{colors.lightTaupe}};"
              catchtap="viewClothesDetail"
              data-id="{{item._id}}"
              hover-class="clothes-item-hover"
            >
              <view class="clothes-image-container">
                <image 
                  wx:if="{{item.tempImageUrl}}" 
                  src="{{item.tempImageUrl}}" 
                  mode="aspectFit" 
                  lazy-load="true"
                  class="clothes-image"
                ></image>
                <view 
                  class="clothes-icon {{item.category === 'ä¸Šè¡£' ? 'tops' : (item.category === 'è£¤å­' ? 'pants' : (item.category === 'å¤–å¥—' ? 'coat' : (item.category === 'è£™å­' ? 'skirt' : 'accessories')))}}" 
                  wx:else
                  style="color: {{colors.darkOlive}};"
                ></view>
              </view>
              <view class="clothes-info">
                <view class="clothes-name" style="color: {{colors.darkOlive}};">{{item.name || ((item.color || '') + ' ' + (item.style || ''))}}</view>
                <view class="clothes-category" style="color: {{colors.darkCoffee}};">{{item.category || 'æœªåˆ†ç±»'}}</view>
              </view>
            </view>
          </block>
        </view>
        
        <!-- ç©ºçŠ¶æ€æç¤º -->
        <view class="empty-state" wx:if="{{filteredClothes.length === 0 && !isLoading}}">
          <view class="empty-icon" style="color: {{colors.darkCoffee}};">ğŸ‘•</view>
          <view class="empty-text" style="color: {{colors.darkOlive}};">
            æš‚æ— {{selectedCategory.category || selectedCategory.name}}ç±»è¡£ç‰©
            <block wx:if="{{selectedCategory.id !== 0}}">ï¼Œç‚¹å‡»"+"æ·»åŠ </block>
          </view>
        </view>
        
        <!-- åˆ†é¡µæ§åˆ¶ -->
        <view class="pagination" wx:if="{{totalClothes > pageSize}}">
          <view class="pagination-info" style="color: {{colors.darkCoffee}};">{{currentPage}}/{{totalPages}} é¡µ</view>
          <view class="pagination-controls">
            <view 
              class="pagination-button prev {{currentPage <= 1 ? 'disabled' : ''}}" 
              bindtap="prevPage"
              style="color: {{colors.darkOlive}}; background-color: {{colors.lightTaupe}};"
            >ä¸Šä¸€é¡µ</view>
            
            <!-- é¡µç æŒ‰é’® -->
            <block wx:for="{{totalPages}}" wx:key="*this" wx:if="{{totalPages <= 5}}">
              <view 
                class="pagination-page {{currentPage === index+1 ? 'active' : ''}}" 
                data-page="{{index+1}}" 
                bindtap="goToPage"
                style="color: {{currentPage === index+1 ? colors.lightTaupe : colors.darkOlive}}; background-color: {{currentPage === index+1 ? colors.darkOlive : colors.lightTaupe}};"
              >{{index+1}}</view>
            </block>
            
            <!-- å¦‚æœé¡µæ•°è¿‡å¤šï¼Œåªæ˜¾ç¤ºéƒ¨åˆ†é¡µç  -->
            <block wx:if="{{totalPages > 5}}">
              <!-- æ˜¾ç¤ºç¬¬1é¡µ -->
              <view 
                class="pagination-page {{currentPage === 1 ? 'active' : ''}}" 
                data-page="1" 
                bindtap="goToPage"
                style="color: {{currentPage === 1 ? colors.lightTaupe : colors.darkOlive}}; background-color: {{currentPage === 1 ? colors.darkOlive : colors.lightTaupe}};"
              >1</view>
              
              <!-- çœç•¥å· -->
              <view wx:if="{{currentPage > 3}}" class="pagination-ellipsis" style="color: {{colors.darkCoffee}};">...</view>
              
              <!-- å½“å‰é¡µçš„å‰ä¸€é¡µï¼ˆå¦‚æœå­˜åœ¨ä¸”ä¸æ˜¯ç¬¬1é¡µï¼‰ -->
              <view 
                wx:if="{{currentPage > 2}}" 
                class="pagination-page" 
                data-page="{{currentPage-1}}" 
                bindtap="goToPage"
                style="color: {{colors.darkOlive}}; background-color: {{colors.lightTaupe}};"
              >{{currentPage-1}}</view>
              
              <!-- å½“å‰é¡µï¼ˆå¦‚æœä¸æ˜¯ç¬¬1é¡µæˆ–æœ€åä¸€é¡µï¼‰ -->
              <view 
                wx:if="{{currentPage !== 1 && currentPage !== totalPages}}" 
                class="pagination-page active" 
                style="color: {{colors.lightTaupe}}; background-color: {{colors.darkOlive}};"
              >{{currentPage}}</view>
              
              <!-- å½“å‰é¡µçš„åä¸€é¡µï¼ˆå¦‚æœå­˜åœ¨ä¸”ä¸æ˜¯æœ€åä¸€é¡µï¼‰ -->
              <view 
                wx:if="{{currentPage < totalPages-1}}" 
                class="pagination-page" 
                data-page="{{currentPage+1}}" 
                bindtap="goToPage"
                style="color: {{colors.darkOlive}}; background-color: {{colors.lightTaupe}};"
              >{{currentPage+1}}</view>
              
              <!-- çœç•¥å· -->
              <view wx:if="{{currentPage < totalPages-2}}" class="pagination-ellipsis" style="color: {{colors.darkCoffee}};">...</view>
              
              <!-- æ˜¾ç¤ºæœ€åä¸€é¡µ -->
              <view 
                class="pagination-page {{currentPage === totalPages ? 'active' : ''}}" 
                data-page="{{totalPages}}" 
                bindtap="goToPage"
                style="color: {{currentPage === totalPages ? colors.lightTaupe : colors.darkOlive}}; background-color: {{currentPage === totalPages ? colors.darkOlive : colors.lightTaupe}};"
              >{{totalPages}}</view>
            </block>
            
            <view 
              class="pagination-button next {{currentPage >= totalPages ? 'disabled' : ''}}" 
              bindtap="nextPage"
              style="color: {{colors.darkOlive}}; background-color: {{colors.lightTaupe}};"
            >ä¸‹ä¸€é¡µ</view>
          </view>
        </view>
      </scroll-view>
      
      <!-- æ·»åŠ æŒ‰é’® -->
      <view class="add-button-container">
        <view class="add-button" style="background-color: {{colors.darkOlive}}; color: {{colors.lightTaupe}};" bindtap="showAddOptions">+</view>
      </view>
    </view>
  </view>
  
  <!-- ä¸Šä¼ ä¸­çŠ¶æ€ -->
  <view class="upload-overlay" wx:if="{{isUploading}}">
    <view class="upload-content" style="background-color: {{colors.lightTaupe}};">
      <view class="upload-spinner" style="border-top-color: {{colors.darkOlive}}; border-color: {{colors.lightTaupe}};"></view>
      <view class="upload-text" style="color: {{colors.darkOlive}};">ä¸Šä¼ åˆ†æä¸­...</view>
    </view>
  </view>
  
  <!-- æ·»åŠ æŒ‰é’® -->
  <view class="add-btn" bindtap="showAddOptions" style="background-color: {{colors.darkOlive}};">
    <view class="add-icon"></view>
  </view>
  
  <!-- æ·»åŠ é€‰é¡¹å¼¹çª— -->
  <view class="add-options-overlay {{showAddOptions ? 'show' : ''}}" bindtap="hideAddOptions">
    <view class="add-options-container" style="background-color: {{colors.lightTaupe}};" catchtap="preventBubble">
      <view class="add-option-title" style="color: {{colors.darkOlive}};">æ·»åŠ è¡£ç‰©</view>
      <view class="add-option" bindtap="addByCamera">
        <view class="add-option-icon camera-icon"></view>
        <view class="add-option-text" style="color: {{colors.darkOlive}};">ä½¿ç”¨ç›¸æœºæ‹ç…§ï¼ˆAIè¯†åˆ«ï¼‰</view>
      </view>
      <view class="add-option" bindtap="addByAlbum">
        <view class="add-option-icon album-icon"></view>
        <view class="add-option-text" style="color: {{colors.darkOlive}};">ä»ç›¸å†Œé€‰æ‹©ï¼ˆAIè¯†åˆ«ï¼‰</view>
      </view>
      <view class="add-option" bindtap="addByUrl">
        <view class="add-option-icon url-icon"></view>
        <view class="add-option-text" style="color: {{colors.darkOlive}};">æ‰‹åŠ¨æ·»åŠ ï¼ˆå¡«å†™è¯¦æƒ…ï¼‰</view>
      </view>
      <view class="cancel-btn" bindtap="hideAddOptions" style="background-color: {{colors.lightTaupe}}; color: {{colors.darkOlive}}; border: 1rpx solid {{colors.darkOlive}};">å–æ¶ˆ</view>
    </view>
  </view>
</view> 