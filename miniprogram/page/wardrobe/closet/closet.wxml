<view class="container" style="background-color: {{themeStyle === 'autumn' ? colors.lightTaupe : pinkBlueColors.pinkLight}}; background-image: {{themeStyle === 'pinkBlue' ? 'linear-gradient(to bottom, white, ' + pinkBlueColors.pinkLight + ')' : 'none'}}">
  <!-- ç²‰è“é£æ ¼é¡¶éƒ¨æ¸å˜ -->
   <view class="top-gradient" wx:if="{{themeStyle === 'pinkBlue'}}" style="background: linear-gradient(to right, {{pinkBlueColors.pinkMedium}}, {{pinkBlueColors.blueMedium}});"></view> 
  <!-- Loading state -->
  <view class="loading-container" wx:if="{{isLoading}}">
    <view class="loading-spinner" style="border-top-color: {{themeStyle === 'autumn' ? colors.darkOlive : pinkBlueColors.pinkDark}}; border-color: {{themeStyle === 'autumn' ? colors.lightTaupe : pinkBlueColors.blueLight}};"></view>
    <view class="loading-text" style="color: {{themeStyle === 'autumn' ? colors.darkOlive : pinkBlueColors.pinkDark}};">åŠ è½½ä¸­...</view>
  </view>
  
  <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
  <view class="main-content" wx:if="{{!isLoading}}">
    <!-- æ ‡é¢˜ -->
    <view class="wardrobe-title {{themeStyle === 'pinkBlue' ? 'wardrobe-title-pink-blue' : ''}}" style="color: {{themeStyle === 'autumn' ? colors.darkOlive : pinkBlueColors.pinkDark}}">æˆ‘çš„è¡£æŸœ</view>
    
    <!-- å¡ç‰‡åŒºåŸŸ -->
    <view class="card-container">
      <!-- æ»‘åŠ¨æŒ‰é’® -->
      <view class="nav-button prev {{themeStyle === 'pinkBlue' ? 'nav-button-pink-blue' : ''}}" catchtap="slidePrev" style="color: {{themeStyle === 'autumn' ? colors.darkOlive : pinkBlueColors.blueDark}};">â—€</view>
      
      <!-- ç±»åˆ«å¡ç‰‡ -->
      <view class="card-wrapper" 
            capture-bind:touchstart="handleTouchStart" 
            capture-bind:touchmove="handleTouchMove" 
            capture-bind:touchend="handleTouchEnd"
            capture-bind:touchcancel="handleTouchEnd">
        <view 
          wx:for="{{categories}}" 
          wx:key="id"
          class="category-card {{currentIndex === index ? 'active' : ''}} {{themeStyle === 'pinkBlue' ? 'category-card-pink-blue' : ''}} {{isSliding || slidingLocked || Date.now() - lastSlideTime < 800 ? 'no-tap' : ''}} {{Date.now() - lastSlideTime < 100 ? 'card-cooling' : ''}}" 
          style="background-color: {{themeStyle === 'autumn' ? (currentIndex === index ? colors.mediumBrown : colors.lightTaupe) : (currentIndex === index ? pinkBlueColors.blueMedium : pinkBlueColors.blueLight)}}; z-index: {{cards[index].zIndex}}; transform: translateX({{cards[index].translateX}}rpx) scale({{cards[index].scale}}); opacity: {{cards[index].opacity}}; {{themeStyle === 'pinkBlue' ? 'box-shadow: 0 6rpx 16rpx rgba(0,0,0,0.1);' : ''}}"
          catchtap="onCardTap"
          data-index="{{index}}"
          hover-class="{{!isSliding && !slidingLocked && Date.now() - lastSlideTime >= 800 ? 'card-hover' : ''}}"
          hover-stay-time="50"
          hover-start-time="50"
          hidden="{{!cards[index].visible}}"
        >
          <view class="category-icon" style="background-color: {{themeStyle === 'autumn' ? colors.darkOlive : pinkBlueColors.pinkDark}}; color: {{themeStyle === 'autumn' ? colors.lightTaupe : 'white'}}; {{themeStyle === 'pinkBlue' ? 'box-shadow: 0 4rpx 8rpx rgba(0,0,0,0.1);' : ''}}">
            {{item.icon}}
          </view>
          <text class="category-name" style="color: {{themeStyle === 'autumn' ? colors.darkOlive : pinkBlueColors.pinkDark}};">{{item.name}}</text>
          <text class="category-en-name" style="color: {{themeStyle === 'autumn' ? colors.darkCoffee : pinkBlueColors.blueDark}};">{{item.enName}}</text>
          <text class="category-count" style="color: {{themeStyle === 'autumn' ? colors.darkCoffee : pinkBlueColors.blueDark}};">{{item.count}} ä»¶</text>
        </view>
      </view>
      
      <!-- æ»‘åŠ¨æŒ‰é’® -->
      <view class="nav-button next {{themeStyle === 'pinkBlue' ? 'nav-button-pink-blue' : ''}}" catchtap="slideNext" style="color: {{themeStyle === 'autumn' ? colors.darkOlive : pinkBlueColors.blueDark}};">â–¶</view>
    </view>
  </view>
  
  <!-- è¯¦æƒ…å¤§å¡ç‰‡ -->
  <view class="detail-card-container {{themeStyle === 'pinkBlue' ? 'detail-card-container-pink-blue' : ''}}" wx:if="{{selectedCategory}}" bindtap="onDetailBackgroundTap">
    <view 
      class="detail-card {{themeStyle === 'pinkBlue' ? 'detail-card-pink-blue' : ''}}" 
      style="background-color: {{themeStyle === 'autumn' ? colors.mediumBrown : 'white'}}; {{themeStyle === 'pinkBlue' ? 'box-shadow: 0 10rpx 25rpx rgba(0,0,0,0.15);' : ''}}"
      catchtap="preventBubble"
    >
      <!-- å¡ç‰‡é¡¶éƒ¨ -->
      <view class="detail-header {{themeStyle === 'pinkBlue' ? 'detail-header-pink-blue' : ''}}" style="{{themeStyle === 'pinkBlue' ? 'background: linear-gradient(to right, ' + pinkBlueColors.pinkMedium + ', ' + pinkBlueColors.blueMedium + ');' : ''}}">
        <text class="detail-title" style="color: {{themeStyle === 'autumn' ? colors.darkOlive : 'white'}};">{{selectedCategory.name}}</text>
        <view class="close-button" bindtap="closeDetail" style="color: {{themeStyle === 'autumn' ? colors.darkOlive : 'white'}};">Ã—</view>
      </view>

      <!-- è¡£ç‰©ç½‘æ ¼ -->
      <scroll-view class="clothes-grid" scroll-y="true" enable-flex="true">
        <view class="grid-container">
          <block wx:for="{{currentPageClothes}}" wx:key="_id">
            <view 
              class="clothes-item {{themeStyle === 'pinkBlue' ? 'clothes-item-pink-blue' : ''}}" 
              style="background-color: {{themeStyle === 'autumn' ? colors.lightTaupe : 'white'}}; {{themeStyle === 'pinkBlue' ? 'box-shadow: 0 4rpx 10rpx rgba(0,0,0,0.1);' : ''}}"
              catchtap="viewClothesDetail"
              data-id="{{item._id}}"
              hover-class="clothes-item-hover"
            >
              <view class="clothes-image-container">
                <image 
                  wx:if="{{item.tempImageUrl}}" 
                  src="{{item.tempImageUrl}}" 
                  mode="aspectFit" 
                  lazy-load="true"
                  class="clothes-image"
                ></image>
                <view 
                  class="clothes-icon {{item.category === 'ä¸Šè¡£' ? 'tops' : (item.category === 'è£¤å­' ? 'pants' : (item.category === 'å¤–å¥—' ? 'coat' : (item.category === 'è£™å­' ? 'skirt' : 'accessories')))}}" 
                  wx:else
                  style="color: {{themeStyle === 'autumn' ? colors.darkOlive : pinkBlueColors.blueMedium}};"
                ></view>
              </view>
              <view class="clothes-info {{themeStyle === 'pinkBlue' ? 'clothes-info-pink-blue' : ''}}">
                <view class="clothes-name" style="color: {{themeStyle === 'autumn' ? colors.darkOlive : pinkBlueColors.pinkDark}};">{{item.name || ((item.color || '') + ' ' + (item.style || ''))}}</view>
                <view class="clothes-category" style="color: {{themeStyle === 'autumn' ? colors.darkCoffee : pinkBlueColors.blueDark}};">{{item.category || 'æœªåˆ†ç±»'}}</view>
              </view>
            </view>
          </block>
        </view>
        
        <!-- ç©ºçŠ¶æ€æç¤º -->
        <view class="empty-state {{themeStyle === 'pinkBlue' ? 'empty-state-pink-blue' : ''}}" wx:if="{{filteredClothes.length === 0 && !isLoading}}">
          <view class="empty-icon" style="color: {{themeStyle === 'autumn' ? colors.darkCoffee : pinkBlueColors.blueMedium}};">ğŸ‘•</view>
          <view class="empty-text" style="color: {{themeStyle === 'autumn' ? colors.darkOlive : pinkBlueColors.pinkDark}};">
            æš‚æ— {{selectedCategory.category || selectedCategory.name}}ç±»è¡£ç‰©
            <block wx:if="{{selectedCategory.id !== 0}}">ï¼Œç‚¹å‡»"+"æ·»åŠ </block>
          </view>
        </view>
        
        <!-- åˆ†é¡µæ§åˆ¶ -->
        <view class="pagination {{themeStyle === 'pinkBlue' ? 'pagination-pink-blue' : ''}}" wx:if="{{totalClothes > pageSize}}" style="{{themeStyle === 'pinkBlue' ? 'border-top: 1rpx solid ' + pinkBlueColors.pinkLight + ';' : ''}}">
          <view class="pagination-info" style="color: {{themeStyle === 'autumn' ? colors.darkCoffee : pinkBlueColors.blueDark}};">{{currentPage}}/{{totalPages}} é¡µ</view>
          <view class="pagination-controls">
            <view 
              class="pagination-button prev {{currentPage <= 1 ? 'disabled' : ''}} {{themeStyle === 'pinkBlue' ? 'pagination-button-pink-blue' : ''}}" 
              bindtap="prevPage"
              style="color: {{themeStyle === 'autumn' ? colors.darkOlive : pinkBlueColors.blueDark}}; background-color: {{themeStyle === 'autumn' ? colors.lightTaupe : 'white'}};"
            >ä¸Šä¸€é¡µ</view>
            
            <!-- é¡µç æŒ‰é’® -->
            <block wx:for="{{totalPages}}" wx:key="*this" wx:if="{{totalPages <= 5}}">
              <view 
                class="pagination-page {{currentPage === index+1 ? 'active' : ''}} {{themeStyle === 'pinkBlue' ? 'pagination-page-pink-blue' : ''}}" 
                data-page="{{index+1}}" 
                bindtap="goToPage"
                style="color: {{currentPage === index+1 ? (themeStyle === 'autumn' ? colors.lightTaupe : 'white') : (themeStyle === 'autumn' ? colors.darkOlive : pinkBlueColors.blueDark)}}; background-color: {{currentPage === index+1 ? (themeStyle === 'autumn' ? colors.darkOlive : pinkBlueColors.blueMedium) : (themeStyle === 'autumn' ? colors.lightTaupe : 'white')}};"
              >{{index+1}}</view>
            </block>
            
            <!-- å¦‚æœé¡µæ•°è¿‡å¤šï¼Œåªæ˜¾ç¤ºéƒ¨åˆ†é¡µç  -->
            <block wx:if="{{totalPages > 5}}">
              <!-- æ˜¾ç¤ºç¬¬1é¡µ -->
              <view 
                class="pagination-page {{currentPage === 1 ? 'active' : ''}}" 
                data-page="1" 
                bindtap="goToPage"
                style="color: {{currentPage === 1 ? colors.lightTaupe : colors.darkOlive}}; background-color: {{currentPage === 1 ? colors.darkOlive : colors.lightTaupe}};"
              >1</view>
              
              <!-- çœç•¥å· -->
              <view wx:if="{{currentPage > 3}}" class="pagination-ellipsis" style="color: {{colors.darkCoffee}};">...</view>
              
              <!-- å½“å‰é¡µçš„å‰ä¸€é¡µï¼ˆå¦‚æœå­˜åœ¨ä¸”ä¸æ˜¯ç¬¬1é¡µï¼‰ -->
              <view 
                wx:if="{{currentPage > 2}}" 
                class="pagination-page" 
                data-page="{{currentPage-1}}" 
                bindtap="goToPage"
                style="color: {{colors.darkOlive}}; background-color: {{colors.lightTaupe}};"
              >{{currentPage-1}}</view>
              
              <!-- å½“å‰é¡µï¼ˆå¦‚æœä¸æ˜¯ç¬¬1é¡µæˆ–æœ€åä¸€é¡µï¼‰ -->
              <view 
                wx:if="{{currentPage !== 1 && currentPage !== totalPages}}" 
                class="pagination-page active" 
                style="color: {{colors.lightTaupe}}; background-color: {{colors.darkOlive}};"
              >{{currentPage}}</view>
              
              <!-- å½“å‰é¡µçš„åä¸€é¡µï¼ˆå¦‚æœå­˜åœ¨ä¸”ä¸æ˜¯æœ€åä¸€é¡µï¼‰ -->
              <view 
                wx:if="{{currentPage < totalPages-1}}" 
                class="pagination-page" 
                data-page="{{currentPage+1}}" 
                bindtap="goToPage"
                style="color: {{colors.darkOlive}}; background-color: {{colors.lightTaupe}};"
              >{{currentPage+1}}</view>
              
              <!-- çœç•¥å· -->
              <view wx:if="{{currentPage < totalPages-2}}" class="pagination-ellipsis" style="color: {{colors.darkCoffee}};">...</view>
              
              <!-- æ˜¾ç¤ºæœ€åä¸€é¡µ -->
              <view 
                class="pagination-page {{currentPage === totalPages ? 'active' : ''}}" 
                data-page="{{totalPages}}" 
                bindtap="goToPage"
                style="color: {{currentPage === totalPages ? colors.lightTaupe : colors.darkOlive}}; background-color: {{currentPage === totalPages ? colors.darkOlive : colors.lightTaupe}};"
              >{{totalPages}}</view>
            </block>
            
            <view 
              class="pagination-button next {{currentPage >= totalPages ? 'disabled' : ''}} {{themeStyle === 'pinkBlue' ? 'pagination-button-pink-blue' : ''}}" 
              bindtap="nextPage"
              style="color: {{themeStyle === 'autumn' ? colors.darkOlive : pinkBlueColors.blueDark}}; background-color: {{themeStyle === 'autumn' ? colors.lightTaupe : 'white'}};"
            >ä¸‹ä¸€é¡µ</view>
          </view>
        </view>
      </scroll-view>
      
      <!-- æ·»åŠ æŒ‰é’® -->
      <view class="add-button-container">
        <view class="add-button {{themeStyle === 'pinkBlue' ? 'add-button-pink-blue' : ''}}" style="background-color: {{themeStyle === 'autumn' ? colors.darkOlive : pinkBlueColors.pinkMedium}}; color: {{themeStyle === 'autumn' ? colors.lightTaupe : 'white'}}; {{themeStyle === 'pinkBlue' ? 'box-shadow: 0 4rpx 12rpx rgba(212, 124, 153, 0.4);' : ''}}" bindtap="showAddOptions">+</view>
      </view>
    </view>
  </view>
  
  <!-- ä¸Šä¼ ä¸­çŠ¶æ€ -->
  
  
  <!-- æ·»åŠ æŒ‰é’® -->
  <view class="add-btn {{themeStyle === 'pinkBlue' ? 'add-btn-pink-blue' : ''}}" bindtap="showAddOptions" style="background-color: {{themeStyle === 'autumn' ? colors.darkOlive : pinkBlueColors.pinkMedium}}; {{themeStyle === 'pinkBlue' ? 'box-shadow: 0 4rpx 12rpx rgba(212, 124, 153, 0.4);' : ''}}">
    <view class="add-icon" style="{{themeStyle === 'pinkBlue' ? 'background-color: ' + pinkBlueColors.pinkMedium + ';' : ''}}"></view>
  </view>
  
  <!-- æ·»åŠ é€‰é¡¹å¼¹çª— -->
  <view class="add-options-overlay {{showAddOptions ? 'show' : ''}} {{themeStyle === 'pinkBlue' ? 'add-options-overlay-pink-blue' : ''}}" bindtap="hideAddOptions">
    <view class="add-options-container {{themeStyle === 'pinkBlue' ? 'add-options-container-pink-blue' : ''}}" style="background-color: {{themeStyle === 'autumn' ? colors.lightTaupe : 'white'}}; {{themeStyle === 'pinkBlue' ? 'box-shadow: 0 -4rpx 16rpx rgba(0,0,0,0.1);' : ''}}" catchtap="preventBubble">
      <view class="add-option-title" style="color: {{themeStyle === 'autumn' ? colors.darkOlive : pinkBlueColors.pinkDark}};">æ·»åŠ è¡£ç‰©</view>
      <view class="add-option {{themeStyle === 'pinkBlue' ? 'add-option-pink-blue' : ''}}" bindtap="addByCamera">
        <view class="add-option-icon camera-icon" style="{{themeStyle === 'pinkBlue' ? 'color: ' + pinkBlueColors.pinkDark + ';' : ''}}"></view>
        <view class="add-option-text" style="color: {{themeStyle === 'autumn' ? colors.darkOlive : pinkBlueColors.blueDark}};">ä½¿ç”¨ç›¸æœºæ‹ç…§ï¼ˆAIè¯†åˆ«ï¼‰</view>
      </view>
      <view class="add-option {{themeStyle === 'pinkBlue' ? 'add-option-pink-blue' : ''}}" bindtap="addByAlbum">
        <view class="add-option-icon album-icon" style="{{themeStyle === 'pinkBlue' ? 'color: ' + pinkBlueColors.pinkDark + ';' : ''}}"></view>
        <view class="add-option-text" style="color: {{themeStyle === 'autumn' ? colors.darkOlive : pinkBlueColors.blueDark}};">ä»ç›¸å†Œé€‰æ‹©ï¼ˆAIè¯†åˆ«ï¼‰</view>
      </view>
      <view class="add-option {{themeStyle === 'pinkBlue' ? 'add-option-pink-blue' : ''}}" bindtap="addByUrl">
        <view class="add-option-icon url-icon" style="{{themeStyle === 'pinkBlue' ? 'color: ' + pinkBlueColors.pinkDark + ';' : ''}}"></view>
        <view class="add-option-text" style="color: {{themeStyle === 'autumn' ? colors.darkOlive : pinkBlueColors.blueDark}};">æ‰‹åŠ¨æ·»åŠ ï¼ˆå¡«å†™è¯¦æƒ…ï¼‰</view>
      </view>
      <view class="cancel-btn {{themeStyle === 'pinkBlue' ? 'cancel-btn-pink-blue' : ''}}" bindtap="hideAddOptions" style="background-color: {{themeStyle === 'autumn' ? colors.lightTaupe : 'white'}}; color: {{themeStyle === 'autumn' ? colors.darkOlive : pinkBlueColors.pinkDark}}; border: 1rpx solid {{themeStyle === 'autumn' ? colors.darkOlive : pinkBlueColors.pinkMedium}};">å–æ¶ˆ</view>
    </view>
  </view>
  <!-- ç²‰è“é£æ ¼åº•éƒ¨æ¸å˜ -->
  <!-- <view class="bottom-gradient" wx:if="{{themeStyle === 'pinkBlue'}}" style="background: linear-gradient(to right, {{pinkBlueColors.blueMedium}}, {{pinkBlueColors.pinkMedium}});"></view> -->
</view>